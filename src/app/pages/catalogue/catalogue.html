<div *ngIf="message" class="catalogue-toast" [innerHTML]="message"></div>
<div *ngIf="!isAdherent" class="catalogue-message">
  <strong>Réservé aux adhérents.</strong>
  <span>Pour ajouter des produits au panier, vous devez payer l’adhésion annuelle (200 F).</span>
  <a href="/users/pay" class="pay-link">Payer l’adhésion</a>
</div>
<div class="cata">
  <h1>Magasin</h1>
  
  <p>
    Les étudiants adhérents peuvent réserver jusqu'à <strong>5 produits</strong> et <strong>2 paniers par semaine</strong>, dans la limite des ressources disponibles.
  </p>


  <!-- Barre de recherche -->
  <form class="catalogue-search" (submit)="onSearch($event)">
    <input
      type="text"
      id="search-input"
      name="search"
      [(ngModel)]="searchTerm"
      placeholder="Rechercher un produit..."
      required
      />
    <button type="submit" id="search-btn"><i class="fas fa-search"></i></button>
  </form>

  <div *ngIf="loading">Chargement...</div>
  <div *ngIf="error">{{ error }}</div>


  <div *ngIf="data">
    <div class="catalogue-categories">
      <a
        [class.active]="selectedCategory === 'all'"
        (click)="filterByCategory('all')"
      >
        Tout
      </a>
      <a
        *ngFor="let cat of data?.categories"
        [class.active]="selectedCategory === cat.id.toString()"
        (click)="filterByCategory(cat.id)"
      >
        {{ cat.name }}
      </a>
    </div>
    
    <div class="product-grid">
      <div
        class="product-card"
        *ngFor="let produit of filteredProduits()"
      >
        <img [src]="produit.image" alt="{{ produit.name }}" class="product-image" />
        <h4>{{ produit.name }}</h4>
        <p>{{ produit.description }}</p>
        <div class="stock">Stock : {{ produit.stock }}</div>
        <div class="quantity-controls">
          <button class="quantity-btn" (click)="decrementQuantity(produit.id)">-</button>
          <span class="quantity">{{ getQuantity(produit.id) }}</span>
          <button class="quantity-btn" (click)="incrementQuantity(produit.id, produit.stock)">+</button>
        </div>
        <button class="add-to-cart" (click)="onAddToCart(produit)">
          Ajouter au panier
        </button>
      </div>
    </div>
  </div>
</div>
